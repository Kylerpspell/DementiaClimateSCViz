<html>
  <head>
    <meta charset="utf-8">
    <title>Dementia Climate Relationships</title>
	<link rel="stylesheet" href="./map.css">
	<script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
  </head>
    <body>
		<div id="mapDiv">
		<!-- Nav bar section-->
		<div class="navbar">
			<ul id="navlist">
				<li>
					<a href="../index.html">Home</a>
				</li>
				<li>
					<a href="../visualizations.html">Visualizations</a>
				</li>
				<li>
					<a href="../data.html">Data</a>
				</li>
				<li>
					<a href="../about.html">About</a>
				</li>
			</ul>
		</div>
		<!-- End of nav bar section -->
			<div id="normDiv">
				<input type="checkbox" id="normalize" checked>
				<label for="normalize" style="font-size: 20px;">Normalize</label>
				</input>
			</div>
			<h3>
				Number of Dementia Cases per County
			</h3>
		</div>
		<script>
			var width = 1200,
				height = 700;

			// make color scale from white to blue from 0.1 to 2.0
			var color = d3.scaleLinear()
				.domain([0, 33000])
				.range(["#a8de78", "#deae78"]);

			var normedColor = d3.scaleLinear()
				.domain([0, 100])
				.range(["#a8de78", "#deae78"]);

			// center on south carolina
			var projection =  d3.geoAlbersUsa()
				.scale(11000)
				.translate([-1850, height/2-850]);
				
			// create path generator and zoom in on south carolina

			var path = d3.geoPath()
				.projection(projection);

			
			var svg = d3.select("body").append("svg")
				.attr("width", width)
				.attr("height", height);

			var normalized = document.getElementById("normalize").checked;

			var makeMap = function(normed){
				var csvPath = "";
				if(normed){
					csvPath = "../data/zipbinnormed.csv";
				}
				else{
					csvPath = "../data/zipbin.csv";
				}
				d3.json("https://raw.githubusercontent.com/deldersveld/topojson/master/countries/united-states/us-albers-counties.json",function(json){
					d3.csv(csvPath, function(data) {
						var countyRates = {};
						data.forEach(function(d) {
							countyRates[d.County] = +d.Count;
						});

						svg.selectAll("path")
							.attr("id", "state_fips")
							.data(topojson.feature(json, json.objects.collection).features.filter(function(d) { return d.properties.state_fips == 45; }))
							.enter()
							.append("path")
							.attr("d", path)
							.attr("stroke","white")
							.attr("fill", function(d) {
								if(normed)
									var value = countyRates[d.properties.name]*100000;
								else
									var value = countyRates[d.properties.name];
								if (value) {
									return color(value)
								} else {
									return "red";
								}
								
							})
						// add title to each county
						.append("title")
							.text(function(d) {
								if(normed)
									return "County: " + d.properties.name + "\nRate: " + Math.round(countyRates[d.properties.name]*100000) + " per 100,000";
								else
									return "County: " + d.properties.name + "\nCount: " + countyRates[d.properties.name];
							});
					});
					
				});
			}	
			makeMap(normalized);

			// update map when checkbox is clicked
			document.getElementById("normalize").onclick = function() {
				normalized = document.getElementById("normalize").checked;
				svg.selectAll("path").remove();
				makeMap(normalized);
			};
		</script>

	</body>
</html>
