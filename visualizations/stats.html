<html>
  <head>
    <meta charset="utf-8">
    <title>Dementia Climate Relationships</title>
		<link rel="stylesheet" href="../styles.css">

		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.9.1/d3.min.js"></script>
    </head>
    <body>
			<!-- Nav bar section-->
			<div class="navbar">
				<ul id="navlist">
					<li>
						<a href="../index.html">Home</a>
					</li>
					<li>
						<a href="../visualizations.html">Visualizations</a>
					</li>
					<li>
						<a href="../data.html">Data</a>
					</li>
					<li>
						<a href="../about.html">About</a>
					</li>
				</ul>
			</div>
			<!-- End of nav bar section -->
			<div class="wrapper">
        <h1> Average Age of Diagnosis </h1>
        <div class="chart"></div>
        <div class="legend"></div>
        <script>
          d3.csv("../data/UseableData.csv", function(data) {
            var datasetAge = 0;
            // get the average age of diagnosis
            for (var i = 0; i < data.length; i++) {
              datasetAge += +data[i].DX_AGE;
            }
            datasetAge = datasetAge / data.length;

            var nationalAvgAge = 80.7;

            var margin = { top: 20, right: 20, bottom: 30, left: 40 };
            var width = 600 - margin.left - margin.right;
            var height = 300 - margin.top - margin.bottom;
            
            var data = [
              { name: "National Average", value: nationalAvgAge },
              { name: "Dataset Average", value: datasetAge }
            ];

            var color = d3.scaleOrdinal()
              .domain(data.map(function(d) { return d.name; }))
              .range(["#a8de78", "#78a8de"]);

            // Set up the chart dimensions
            var margin = { top: 0, right: 20, bottom: 40, left: 40 };
            var width = 900 - margin.left - margin.right;
            var height = 650 - margin.top - margin.bottom;

            // Create the chart SVG element
            var svg = d3.select(".chart")
              .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // Create the scales for the chart
            var xScale = d3.scaleLinear()
              .domain([0,85])
              .range([0, width]);
              
            var yScale = d3.scaleBand()
              .domain(data.map(function(d) { return d.name; }))
              .range([height, 0])
              .padding(0.10);

            // Add the bars to the chart
            var bars = svg.selectAll(".bar")
              .data(data)
              .enter()
              .append("rect")
              .attr("class", "bar")
              .attr("y", function(d) { return yScale(d.name); })
              .attr("height", yScale.bandwidth())
              .attr("width", 0)
              .attr("fill", function(d) { return color(d.name); })
              .transition()
              .duration(2500)
              .attr("width", function(d) { return xScale(d.value); });

            // Add the numbers to the tops of the bars
            var barLabels = svg.selectAll(".bar-label")
              .data(data)
              .enter()
              .append("text")
              .attr("class", "bar-label")
              .attr("color", function(d) { return d.value > 80 ? "red" : "black"; })
              .attr("x", 0) // start at the left of the containing rect
              .attr("y", function(d) { return yScale(d.name) + yScale.bandwidth() / 2; })
              .attr("dx", -5) // offset to the left
              .attr("dy", 4) // offset down
              .text(0) // start with 0
              .transition()
              .duration(2500)
              .attr("x", function(d) { return xScale(d.value); })
              .tween("text", function(d) {
                var selection = d3.select(this);    // selection of node being transitioned
                var start = d3.select(this).text(); // start value prior to transition
                var end = d.value                   // specified end value
                var interpolator = d3.interpolateNumber(start,end); // d3 interpolator
                return function(t) {
                  selection.text(Math.round(interpolator(t)*10)/10); // set the text to interpolated value
                };
              });
              // Add the x-axis to the chart
              var xAxis = d3.axisBottom(xScale);
              svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);
              
              // make the axis and ticks white
              svg.selectAll(".axis path")
                .attr("stroke", "white")
                .attr("stroke-width", 2);

              svg.selectAll(".axis line")
                .attr("stroke", "white")
                .attr("stroke-width", 2);

              svg.selectAll(".tick line")
                .attr("stroke", "white")
                .attr("stroke-width", 2);

              svg.selectAll(".tick text")
                .attr("fill", "white")
                .attr("font-size", "1.5em");
              // label the x-axis
              svg.append("g")
                .append("text")
                .attr("class", "x axis-label")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom - 5)
                .attr("text-anchor", "middle")
                .attr("font-size", "1.5em")
                .attr("fill", "white")
                .text("Age in Years");


              // Add a legend to the chart
              var legend = d3.select(".legend")
                .selectAll("div")
                .data(data)
                .enter()
                .append("div")
                .attr("class", "legend-item grow");
                
              legend.append("svg")
                .attr("width", 20)
                .attr("height", 20)
                .append("rect")
                .attr("width", 20)
                .attr("height", 20)
                .style("fill", function(d) { return color(d.name); });

              legend.append("span")
                .attr("class", "legend-label")
                .attr("padding-left", "10px")
                .text(function(d) { return "    " + d.name; });
            });
        </script>
			</div>
	</body>
</html>